<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LBOM Logbook">
    <title>LBOM - Mobile Daily Logbook</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3c72 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }
        
        .mobile-container {
            max-width: 100vw;
            min-height: 100vh;
            background: white;
            position: relative;
        }
        
        .mobile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 44px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
        }
        
        .mobile-logo {
            height: 28px;
            width: 28px;
            border-radius: 4px;
            background: white;
            padding: 2px;
            flex-shrink: 0;
        }
        
        .mobile-title {
            font-size: 0.9em;
            font-weight: 600;
            margin-left: 8px;
            line-height: 1.1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .user-badge {
            background: rgba(255,255,255,0.15);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 3px 6px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.7em;
            font-weight: 600;
            min-height: 20px;
        }
        
        .header-date {
            font-size: 0.65em;
            opacity: 0.9;
            text-align: center;
            margin-top: 2px;
        }
        
        /* Login Screen Mobile */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3c72 100%);
        }
        
        .login-box {
            background: white;
            padding: 30px 25px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-title {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .mobile-input, .mobile-select {
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .mobile-input:focus, .mobile-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .mobile-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
        }
        
        .mobile-btn:active {
            transform: scale(0.98);
        }
        
        .mobile-btn.secondary {
            background: #17a2b8;
        }
        
        .mobile-btn.danger {
            background: #6c757d;
        }
        
        .mobile-btn.success {
            background: #28a745;
        }
        
        /* Main Content Mobile */
        .main-content {
            padding: 12px;
            display: none;
            min-height: calc(100vh - 60px);
        }
        
        .main-content.active {
            display: block;
        }
        
        .mobile-date-selector {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .date-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .date-label {
            font-weight: 600;
            color: #333;
            font-size: 0.85em;
            min-width: 65px;
        }
        
        .date-input {
            flex: 1;
            padding: 8px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .load-date-btn {
            padding: 8px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            min-height: 36px;
        }
        
        .status-row {
            display: flex;
            justify-content: center;
            margin-top: 8px;
        }
        
        .status-indicator {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-ready { background: #d1ecf1; color: #0c5460; }
        .status-saving { background: #fff3cd; color: #856404; }
        .status-saved { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        
        .section-title {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 3px solid #667eea;
            padding-bottom: 6px;
        }
        
        .mobile-form-group {
            margin-bottom: 18px;
        }
        
        .mobile-label {
            display: block;
            margin-bottom: 6px;
            color: #444;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .required {
            color: #dc3545;
        }
        
        .mobile-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            min-height: 90px;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .mobile-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .mobile-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 18px;
        }
        
        .mobile-number-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .mobile-number-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .mobile-action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }
        
        .mobile-action-buttons .mobile-btn {
            min-height: 48px;
            font-size: 15px;
        }
        
        /* Dashboard Grid Mobile */
        .mobile-dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .mobile-stats-card {
            background: #f8f9fa;
            padding: 15px 12px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            text-align: center;
        }
        
        .stats-number {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 4px;
        }
        
        .stats-label {
            color: #666;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .mobile-entries-container {
            background: white;
            border: 1px solid #e0e6ed;
            border-radius: 12px;
            overflow: hidden;
            max-height: 55vh;
            overflow-y: auto;
        }
        
        .mobile-entry-item {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.3s ease;
        }
        
        .mobile-entry-item:active {
            background: #f8f9fa;
        }
        
        .mobile-entry-item:last-child {
            border-bottom: none;
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .entry-user {
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }
        
        .entry-activity {
            background: #e8f4f8;
            color: #0c5460;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .entry-summary {
            color: #666;
            font-size: 0.8em;
            margin-bottom: 6px;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .entry-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7em;
            color: #888;
        }
        
        .entry-people {
            color: #667eea;
            font-weight: 600;
        }
        
        .mobile-view-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.65em;
            font-weight: 600;
        }
        
        /* Past Logs View Mobile */
        .past-logs-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .mobile-summary-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }
        
        .summary-title {
            color: #333;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1em;
            font-weight: 600;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .summary-stat {
            text-align: center;
            background: white;
            padding: 10px 6px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .summary-stat-number {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }
        
        .summary-stat-label {
            color: #666;
            font-size: 0.7em;
            margin-top: 2px;
        }
        
        .mobile-log-entry {
            background: white;
            border: 1px solid #e0e6ed;
            border-radius: 12px;
            margin-bottom: 12px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .mobile-log-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .log-date-info {
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .log-time-info {
            opacity: 0.9;
            font-size: 0.75em;
            margin-top: 2px;
        }
        
        .log-stats-badge {
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: 600;
        }
        
        .mobile-log-content {
            padding: 12px;
        }
        
        .log-section {
            margin-bottom: 12px;
        }
        
        .log-section:last-child {
            margin-bottom: 0;
        }
        
        .log-section-title {
            color: #667eea;
            margin: 0 0 6px 0;
            font-size: 0.8em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .section-badge {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.65em;
            font-weight: 600;
        }
        
        .badge-activities { background: #e8f4f8; color: #0c5460; }
        .badge-outcomes { background: #d4edda; color: #155724; }
        .badge-challenges { background: #fff3cd; color: #856404; }
        .badge-notes { background: #e2e3e5; color: #383d41; }
        .badge-followup { background: #f8d7da; color: #721c24; }
        
        .log-section-content {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
            line-height: 1.4;
            color: #555;
            font-size: 0.8em;
        }
        
        .log-actions {
            display: flex;
            gap: 6px;
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }
        
        .mobile-export-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.7em;
            font-weight: 600;
            flex: 1;
        }
        
        /* Instructions Mobile */
        .mobile-instructions {
            margin-top: 15px;
            font-size: 0.75em;
            color: #666;
            text-align: center;
            line-height: 1.3;
        }
        
        .instructions-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 480px) {
            .mobile-form-row {
                grid-template-columns: 1fr;
            }
            
            .mobile-dashboard-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .summary-stats {
                grid-template-columns: 1fr;
                gap: 6px;
            }
            
            .mobile-title {
                font-size: 0.8em;
            }
            
            .main-content {
                padding: 8px;
            }
        }
        
        @media (max-width: 350px) {
            .entry-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            .log-actions {
                flex-direction: column;
            }
            
            .mobile-title {
                font-size: 0.75em;
            }
        }
        
        /* Safari iOS specific fixes */
        @supports (-webkit-touch-callout: none) {
            .mobile-input, .mobile-textarea, .mobile-number-input {
                font-size: 16px;
            }
        }
        
        /* Hide elements when keyboard is open */
        @media (max-height: 500px) and (orientation: landscape) {
            .mobile-header {
                padding: 4px 12px;
            }
            
            .mobile-title {
                font-size: 0.75em;
            }
            
            .header-date {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div class="mobile-header">
            <div class="header-content">
                <div class="header-left">
                    <img src="https://lovebotswana.org/wp-content/uploads/2021/06/cropped-Love-Botswana-Logo-300x300.png" 
                         alt="LBOM Logo" 
                         class="mobile-logo"
                         onerror="this.style.display='none'">
                    <div class="mobile-title">LBOM Daily Logbook</div>
                </div>
                <div class="user-badge" id="userInfo" style="display: none;">
                    <span id="currentUser"></span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
            <div class="header-date" id="currentDate"></div>
        </div>

        <!-- Login Screen -->
        <div class="login-container" id="loginScreen">
            <div class="login-box">
                <h2 class="login-title">Login to Daily Logbook</h2>
                <form class="login-form" onsubmit="login(event)">
                    <select id="userRole" class="mobile-select" required>
                        <option value="">Select Department Activity</option>
                        <option value="operation-blessing">Operation Blessing</option>
                        <option value="counseling-session">Counseling Session</option>
                        <option value="play-therapy">Play Therapy</option>
                        <option value="meeting">Meeting</option>
                        <option value="case">Case</option>
                        <option value="donations">Donations</option>
                        <option value="intake-session">Intake Session</option>
                        <option value="workshop">Workshop</option>
                        <option value="other-activities">Other Activities</option>
                        <option value="admin">Administrator/Supervisor</option>
                    </select>
                    <input type="text" id="userName" class="mobile-input" placeholder="Enter your full name" required>
                    <button type="submit" class="mobile-btn">Login & Start Daily Log</button>
                </form>
                <div class="mobile-instructions">
                    <div class="instructions-title">Instructions:</div>
                    <p>Social Workers: Log daily activities - saved permanently to Google Sheets</p>
                    <p>Administrators: View all team entries and generate reports</p>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="main-content" id="dashboard">
            <div class="mobile-date-selector">
                <div class="date-row">
                    <label class="date-label" for="logDate">Log Date:</label>
                    <input type="date" id="logDate" class="date-input">
                    <button class="load-date-btn" onclick="loadDateData()">Load</button>
                </div>
                <div class="status-row">
                    <span class="status-indicator status-ready" id="saveStatus">Ready to Log</span>
                </div>
            </div>

            <!-- Staff Daily Log Entry View -->
            <div id="staffView" style="display: none;">
                <h2 class="section-title" id="staffTitle">Daily Activity Log Entry</h2>
                
                <div class="mobile-form-group">
                    <label class="mobile-label" for="staffActivities">Today's Activities & Description <span class="required">*</span></label>
                    <textarea id="staffActivities" class="mobile-textarea" placeholder="Describe the specific activities, services provided, or work completed today..." required></textarea>
                </div>
                
                <div class="mobile-form-group">
                    <label class="mobile-label" for="staffOutcomes">Key Outcomes & Results <span class="required">*</span></label>
                    <textarea id="staffOutcomes" class="mobile-textarea" placeholder="What were the main outcomes, results, or positive impacts from today's activities..." required></textarea>
                </div>
                
                <div class="mobile-form-row">
                    <div class="mobile-form-group">
                        <label class="mobile-label" for="staffPeopleServed">People Served</label>
                        <input type="number" id="staffPeopleServed" class="mobile-number-input" placeholder="Number" min="0">
                    </div>
                    <div class="mobile-form-group">
                        <label class="mobile-label" for="staffDuration">Time (minutes)</label>
                        <input type="number" id="staffDuration" class="mobile-number-input" placeholder="Duration" min="0">
                    </div>
                </div>

                <div class="mobile-form-group">
                    <label class="mobile-label" for="staffChallenges">Challenges or Issues Encountered</label>
                    <textarea id="staffChallenges" class="mobile-textarea" placeholder="Describe any challenges, obstacles, or issues you encountered today..."></textarea>
                </div>
                
                <div class="mobile-form-group">
                    <label class="mobile-label" for="staffNotes">Additional Notes & Observations</label>
                    <textarea id="staffNotes" class="mobile-textarea" placeholder="Additional notes, observations, follow-up needed, or other relevant information..."></textarea>
                </div>

                <div class="mobile-form-group">
                    <label class="mobile-label" for="staffFollowUp">Follow-up Actions Required</label>
                    <textarea id="staffFollowUp" class="mobile-textarea" placeholder="What follow-up actions or next steps are needed based on today's activities?"></textarea>
                </div>

                <div class="mobile-action-buttons">
                    <button class="mobile-btn" onclick="saveToGoogleSheets()">Save to Google Sheets</button>
                    <button class="mobile-btn secondary" onclick="viewMyPastLogs()">View My Past Logs</button>
                    <button class="mobile-btn secondary" onclick="exportMyDailyLog()">Export My Log</button>
                    <button class="mobile-btn danger" onclick="clearStaffForm()">Clear Form</button>
                </div>
            </div>

            <!-- My Past Logs View -->
            <div id="pastLogsView" style="display: none;">
                <h2 class="section-title" id="pastLogsTitle">My Past Daily Logs</h2>
                
                <div class="past-logs-actions">
                    <button class="mobile-btn" onclick="loadMyPastLogs()">Refresh My Logs</button>
                    <button class="mobile-btn secondary" onclick="backToStaffView()">Back to Daily Log</button>
                </div>

                <div class="mobile-entries-container" id="myPastLogsList">
                    <div style="text-align: center; padding: 30px; color: #666;">
                        Click "Refresh My Logs" to load your past entries
                    </div>
                </div>
            </div>

            <!-- Administrator Central Dashboard View -->
            <div id="adminView" style="display: none;">
                <div class="mobile-dashboard-grid">
                    <div class="mobile-stats-card">
                        <div class="stats-number" id="totalEntries">0</div>
                        <div class="stats-label">Total Entries</div>
                    </div>
                    <div class="mobile-stats-card">
                        <div class="stats-number" id="totalPeopleServed">0</div>
                        <div class="stats-label">People Served</div>
                    </div>
                    <div class="mobile-stats-card">
                        <div class="stats-number" id="activeStaff">0</div>
                        <div class="stats-label">Active Staff</div>
                    </div>
                    <div class="mobile-stats-card">
                        <div class="stats-number" id="totalHours">0.0</div>
                        <div class="stats-label">Total Hours</div>
                    </div>
                </div>

                <div class="mobile-action-buttons">
                    <button class="mobile-btn secondary" onclick="loadAllEntries()">Load All Entries</button>
                    <button class="mobile-btn secondary" onclick="openGoogleSheets()">Open Google Sheets</button>
                </div>

                <h3 class="section-title">All Team Log Entries</h3>
                <div class="mobile-entries-container" id="centralLogEntries">
                    <div style="text-align: center; padding: 30px; color: #666;">
                        Click "Load All Entries" to retrieve data from Google Sheets
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let userRole = null;
        let currentDate = '';
        let sheetsId = '1r93GO6gRXHvLs0bqiPz5WtH5fsLhTzsZrRMBb20n4ZM';
        let centralLogEntries = [];

        function init() {
            updateCurrentDate();
            setDefaultDate();
            
            // Prevent zoom on double tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Handle iOS keyboard
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                document.addEventListener('focusin', function() {
                    setTimeout(() => {
                        window.scrollTo(0, 0);
                        document.body.scrollTop = 0;
                    }, 100);
                });
            }
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            currentDate = today;
            document.getElementById('logDate').value = today;
        }

        function login(event) {
    event.preventDefault();
    userRole = document.getElementById('userRole').value;
    currentUser = document.getElementById('userName').value.trim();
    
    if (!userRole || !currentUser) {
        alert('Please select your activity and enter your name.');
        return;
    }

    document.getElementById('currentUser').textContent = `${currentUser}`;
    document.getElementById('userInfo').style.display = 'flex';
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('dashboard').classList.add('active');
    
    if (userRole === 'admin') {
        showAdminView();
    } else {
        showStaffView();
    }
}
        function getRoleDisplayName(role) {
            const roleNames = {
                'admin': 'Administrator/Supervisor',
                'operation-blessing': 'Operation Blessing',
                'counseling-session': 'Counseling Session',
                'play-therapy': 'Play Therapy',
                'meeting': 'Meeting',
                'case': 'Case',
                'donations': 'Donations',
                'intake-session': 'Intake Session',
                'workshop': 'Workshop',
                'other-activities': 'Other Activities'
            };
            return roleNames[role] || role;
        }

        function showStaffView() {
            document.getElementById('staffView').style.display = 'block';
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('pastLogsView').style.display = 'none';
            document.getElementById('staffTitle').textContent = `${getRoleDisplayName(userRole)} - Daily Log Entry`;
        }

        function showAdminView() {
            document.getElementById('staffView').style.display = 'none';
            document.getElementById('adminView').style.display = 'block';
            document.getElementById('pastLogsView').style.display = 'none';
        }

        function viewMyPastLogs() {
            document.getElementById('staffView').style.display = 'none';
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('pastLogsView').style.display = 'block';
            document.getElementById('pastLogsTitle').textContent = `${currentUser} - Past Daily Logs`;
            loadMyPastLogs();
        }

        function backToStaffView() {
            showStaffView();
        }

        function loadDateData() {
            currentDate = document.getElementById('logDate').value;
            if (userRole === 'admin') {
                loadAllEntries();
            }
        }

        async function loadAllEntries() {
            const container = document.getElementById('centralLogEntries');
            container.innerHTML = '<div style="text-align: center; padding: 30px; color: #666;">Loading all entries...</div>';

            const methods = [
                { name: 'getMyLogs with empty filters', data: { action: 'getMyLogs', staffName: '', activityType: '' } },
                { name: 'getTodaysEntries with empty date', data: { action: 'getTodaysEntries', date: '' } },
                { name: 'getTodaysEntries with specific date', data: { action: 'getTodaysEntries', date: currentDate } },
                { name: 'getAllEntries', data: { action: 'getAllEntries' } }
            ];

            for (const method of methods) {
                try {
                    const formData = new FormData();
                    Object.keys(method.data).forEach(key => {
                        formData.append(key, method.data[key]);
                    });

                    const response = await fetch('https://script.google.com/macros/s/AKfycbxOBFd50VWteiHsATWTXIJv1q7aLWRZR0uku-zZgZfb-VwigCGVBzDy4Q9z49OLnvJDYg/exec', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success && result.data && Array.isArray(result.data) && result.data.length > 0) {
                        centralLogEntries = result.data;
                        updateDashboardStats(result.data);
                        displayCentralEntries(result.data);
                        return;
                    }
                } catch (error) {
                    console.log(`${method.name} failed: ${error.message}`);
                }
            }

            container.innerHTML = `
                <div style="text-align: center; padding: 30px; color: #666;">
                    <h3 style="color: #dc3545; margin-bottom: 15px;">Unable to Load Entries</h3>
                    <p style="margin-bottom: 12px;">All automatic loading methods failed. This could be due to:</p>
                    <ul style="text-align: left; margin: 15px auto; max-width: 280px; font-size: 0.8em;">
                        <li>Google Apps Script not responding</li>
                        <li>No entries exist in the spreadsheet yet</li>
                        <li>Network connectivity issues</li>
                    </ul>
                    <div style="margin-top: 15px;">
                        <button class="mobile-btn secondary" onclick="openGoogleSheets()" style="margin: 4px; font-size: 0.75em;">
                            View Google Sheets Directly
                        </button>
                    </div>
                </div>
            `;
            updateDashboardStats([]);
        }

        async function saveToGoogleSheets() {
            if (!document.getElementById('staffActivities').value.trim() || !document.getElementById('staffOutcomes').value.trim()) {
                alert('Please fill in all required fields (Activities and Outcomes).');
                return;
            }

            const saveStatus = document.getElementById('saveStatus');
            saveStatus.textContent = 'Saving...';
            saveStatus.className = 'status-indicator status-saving';

            const formData = new FormData();
            formData.append('date', currentDate);
            formData.append('time', new Date().toLocaleTimeString());
            formData.append('staffName', currentUser);
            formData.append('activityType', getRoleDisplayName(userRole));
            formData.append('activities', document.getElementById('staffActivities').value.trim());
            formData.append('outcomes', document.getElementById('staffOutcomes').value.trim());
            formData.append('peopleServed', document.getElementById('staffPeopleServed').value || '0');
            formData.append('duration', document.getElementById('staffDuration').value || '0');
            formData.append('challenges', document.getElementById('staffChallenges').value.trim());
            formData.append('notes', document.getElementById('staffNotes').value.trim());
            formData.append('followUp', document.getElementById('staffFollowUp').value.trim());

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbxOBFd50VWteiHsATWTXIJv1q7aLWRZR0uku-zZgZfb-VwigCGVBzDy4Q9z49OLnvJDYg/exec', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    saveStatus.textContent = 'Saved to Google Sheets';
                    saveStatus.className = 'status-indicator status-saved';
                    alert('Your daily log has been saved to Google Sheets successfully!');
                } else {
                    throw new Error(result.error || 'Save failed');
                }
            } catch (error) {
                saveStatus.textContent = 'Auto-save failed - Manual copy required';
                saveStatus.className = 'status-indicator status-error';
                
                const rowData = [currentDate, new Date().toLocaleTimeString(), currentUser, getRoleDisplayName(userRole),
                    document.getElementById('staffActivities').value.trim(), document.getElementById('staffOutcomes').value.trim(),
                    document.getElementById('staffPeopleServed').value || '0', document.getElementById('staffDuration').value || '0',
                    document.getElementById('staffChallenges').value.trim(), document.getElementById('staffNotes').value.trim(),
                    document.getElementById('staffFollowUp').value.trim()];
                
                const manualEntry = rowData.join('\t');
                if (confirm(`Unable to auto-save. Copy this data to your clipboard?\n\n${manualEntry}`)) {
                    navigator.clipboard.writeText(manualEntry).then(() => {
                        alert('Data copied to clipboard. Paste it into your Google Sheet.');
                    }).catch(() => {
                        alert('Please manually copy this data to your Google Sheet:\n\n' + manualEntry);
                    });
                }
            }
        }

        async function loadMyPastLogs() {
            const container = document.getElementById('myPastLogsList');
            container.innerHTML = '<div style="text-align: center; padding: 30px; color: #666;">Loading your past entries...</div>';

            try {
                const formData = new FormData();
                formData.append('action', 'getMyLogs');
                formData.append('staffName', currentUser);
                formData.append('activityType', getRoleDisplayName(userRole));

                const response = await fetch('https://script.google.com/macros/s/AKfycbxOBFd50VWteiHsATWTXIJv1q7aLWRZR0uku-zZgZfb-VwigCGVBzDy4Q9z49OLnvJDYg/exec', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success && result.data) {
                    window.myPastLogs = result.data;
                    displayMyPastLogs(result.data);
                } else {
                    throw new Error(result.error || 'Failed to load data');
                }
            } catch (error) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #666;">
                        <p>Unable to load past logs automatically.</p>
                        <p><strong>Debug Info:</strong> Searching for user "${currentUser}"</p>
                        <p><strong>Alternative:</strong> <a href="https://docs.google.com/spreadsheets/d/${sheetsId}/edit" target="_blank">Click here to view your entries directly in Google Sheets</a></p>
                        <p>Filter by your name: ${currentUser}</p>
                    </div>
                `;
            }
        }

        function displayMyPastLogs(logs) {
            const container = document.getElementById('myPastLogsList');
            
            if (!logs || logs.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #666;">
                        <div style="font-size: 1.5em; margin-bottom: 15px; opacity: 0.3;">📋</div>
                        <h3 style="color: #333; margin-bottom: 12px;">No past entries found</h3>
                        <p><strong>Searched for:</strong> "${currentUser}"</p>
                        <p style="margin-bottom: 12px;">Make sure you're using the exact name from Google Sheets</p>
                        <a href="https://docs.google.com/spreadsheets/d/${sheetsId}/edit" target="_blank" 
                           class="mobile-btn secondary" style="display: inline-block; text-decoration: none;">
                            Check Google Sheets
                        </a>
                    </div>
                `;
                return;
            }

            const totalPeople = logs.reduce((sum, log) => sum + (parseInt(log.peopleServed) || 0), 0);
            const totalHours = logs.reduce((sum, log) => sum + (parseInt(log.duration) || 0), 0) / 60;
            const activitiesCount = logs.length;

            container.innerHTML = `
                <div class="mobile-summary-card">
                    <h3 class="summary-title">
                        <span style="background: #667eea; color: white; padding: 6px; border-radius: 50%; 
                                     width: 26px; height: 26px; display: flex; align-items: center; 
                                     justify-content: center; font-size: 12px;">📊</span>
                        Your Activity Summary
                    </h3>
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <div class="summary-stat-number">${activitiesCount}</div>
                            <div class="summary-stat-label">Log Entries</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-number">${totalPeople}</div>
                            <div class="summary-stat-label">People Served</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-number">${totalHours.toFixed(1)}</div>
                            <div class="summary-stat-label">Total Hours</div>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 12px;">
                    <h3 style="color: #333; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 1em;">
                        <span style="background: #28a745; color: white; padding: 5px; border-radius: 50%; 
                                     width: 26px; height: 26px; display: flex; align-items: center; 
                                     justify-content: center; font-size: 12px;">📋</span>
                        Recent Activity Log Entries
                    </h3>
                </div>

                ${logs.map((log, index) => `
                    <div class="mobile-log-entry">
                        <div class="mobile-log-header">
                            <div>
                                <div class="log-date-info">${new Date(log.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</div>
                                <div class="log-time-info">${log.time} • ${log.activityType}</div>
                            </div>
                            <div class="log-stats-badge">
                                ${log.peopleServed || 0} people • ${log.duration || 0}min
                            </div>
                        </div>
                        
                        <div class="mobile-log-content">
                            <div class="log-section">
                                <h4 class="log-section-title">
                                    <span class="section-badge badge-activities">Activities Performed</span>
                                </h4>
                                <div class="log-section-content">
                                    ${log.activities || 'No activities specified'}
                                </div>
                            </div>
                            
                            <div class="log-section">
                                <h4 class="log-section-title">
                                    <span class="section-badge badge-outcomes">Key Outcomes</span>
                                </h4>
                                <div class="log-section-content">
                                    ${log.outcomes || 'No outcomes specified'}
                                </div>
                            </div>
                            
                            ${log.challenges ? `
                                <div class="log-section">
                                    <h4 class="log-section-title">
                                        <span class="section-badge badge-challenges">Challenges Encountered</span>
                                    </h4>
                                    <div class="log-section-content" style="border-left-color: #ffc107;">
                                        ${log.challenges}
                                    </div>
                                </div>
                            ` : ''}

                            ${log.notes ? `
                                <div class="log-section">
                                    <h4 class="log-section-title">
                                        <span class="section-badge badge-notes">Additional Notes</span>
                                    </h4>
                                    <div class="log-section-content" style="border-left-color: #17a2b8;">
                                        ${log.notes}
                                    </div>
                                </div>
                            ` : ''}

                            ${log.followUp ? `
                                <div class="log-section">
                                    <h4 class="log-section-title">
                                        <span class="section-badge badge-followup">Follow-up Actions</span>
                                    </h4>
                                    <div class="log-section-content" style="border-left-color: #dc3545;">
                                        ${log.followUp}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="log-actions">
                                <button onclick="exportSingleLog(${JSON.stringify(log).replace(/"/g, '&quot;')})" class="mobile-export-btn">
                                    Export This Log
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function exportSingleLog(log) {
            const htmlContent = createDailyLogHTML({
                activity: log.activityType,
                staffName: log.staffName || currentUser,
                date: log.date,
                activities: log.activities || 'No activities specified',
                outcomes: log.outcomes || 'No outcomes specified',
                peopleServed: log.peopleServed || 'Not specified',
                duration: log.duration || 'Not specified',
                challenges: log.challenges || 'No challenges reported',
                notes: log.notes || 'No additional notes',
                followUp: log.followUp || 'No follow-up actions specified'
            });
            
            downloadFile(htmlContent, `Log_${log.activityType.replace(/\s+/g, '_')}_${log.date}.html`);
        }

        function updateDashboardStats(entries) {
            document.getElementById('totalEntries').textContent = entries.length;
            const totalPeople = entries.reduce((sum, entry) => sum + (parseInt(entry.peopleServed) || 0), 0);
            document.getElementById('totalPeopleServed').textContent = totalPeople;
            const uniqueStaff = new Set(entries.map(entry => entry.staff || entry.staffName)).size;
            document.getElementById('activeStaff').textContent = uniqueStaff;
            const totalMinutes = entries.reduce((sum, entry) => sum + (parseInt(entry.duration) || 0), 0);
            document.getElementById('totalHours').textContent = (totalMinutes / 60).toFixed(1);
        }

        function displayCentralEntries(entries) {
            const container = document.getElementById('centralLogEntries');
            
            if (!entries || entries.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 30px; color: #666;">No entries found</div>';
                return;
            }

            const sortedEntries = entries.sort((a, b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = sortedEntries.map(entry => `
                <div class="mobile-entry-item">
                    <div class="entry-header">
                        <div>
                            <div class="entry-user">${entry.staff || entry.staffName}</div>
                            <div style="font-size: 0.7em; color: #888; margin-top: 1px;">
                                ${new Date(entry.date).toLocaleDateString()} at ${entry.time}
                            </div>
                        </div>
                        <div class="entry-activity">${entry.activity || entry.activityType}</div>
                    </div>
                    
                    <div class="entry-summary">
                        <strong>Activities:</strong> ${(entry.activities || 'No activities specified').substring(0, 80)}${entry.activities && entry.activities.length > 80 ? '...' : ''}
                    </div>
                    
                    <div class="entry-summary">
                        <strong>Outcomes:</strong> ${(entry.outcomes || 'No outcomes specified').substring(0, 80)}${entry.outcomes && entry.outcomes.length > 80 ? '...' : ''}
                    </div>
                    
                    <div class="entry-meta">
                        <span class="entry-time">${entry.peopleServed || 0} people • ${entry.duration || 0}min</span>
                        <button class="mobile-view-btn" onclick="viewFullEntry(${JSON.stringify(entry).replace(/"/g, '&quot;')})">
                            View Full
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function viewFullEntry(entry) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center; padding: 15px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; max-width: 450px; 
                           width: 100%; max-height: 85vh; overflow-y: auto;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                               color: white; padding: 12px; border-radius: 15px 15px 0 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; font-size: 1em;">${entry.staff || entry.staffName}</div>
                                <div style="opacity: 0.9; font-size: 0.85em;">${new Date(entry.date).toLocaleDateString()} • ${entry.activity || entry.activityType}</div>
                            </div>
                            <button onclick="this.closest('.modal').remove()" style="
                                background: rgba(255,255,255,0.2); border: none; color: white; 
                                padding: 6px 10px; border-radius: 50%; cursor: pointer; font-size: 14px;
                            ">×</button>
                        </div>
                    </div>
                    
                    <div style="padding: 15px;">
                        <div style="margin-bottom: 12px;">
                            <h4 style="color: #667eea; margin-bottom: 6px; font-size: 0.85em;">Activities Performed</h4>
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; border-left: 3px solid #667eea; font-size: 0.8em;">
                                ${entry.activities || 'No activities specified'}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 12px;">
                            <h4 style="color: #667eea; margin-bottom: 6px; font-size: 0.85em;">Key Outcomes</h4>
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; border-left: 3px solid #28a745; font-size: 0.8em;">
                                ${entry.outcomes || 'No outcomes specified'}
                            </div>
                        </div>
                        
                        ${entry.challenges ? `
                            <div style="margin-bottom: 12px;">
                                <h4 style="color: #667eea; margin-bottom: 6px; font-size: 0.85em;">Challenges</h4>
                                <div style="background: #fff3cd; padding: 10px; border-radius: 8px; border-left: 3px solid #ffc107; font-size: 0.8em;">
                                    ${entry.challenges}
                                </div>
                            </div>
                        ` : ''}

                        ${entry.notes ? `
                            <div style="margin-bottom: 12px;">
                                <h4 style="color: #667eea; margin-bottom: 6px; font-size: 0.85em;">Notes</h4>
                                <div style="background: #e8f4f8; padding: 10px; border-radius: 8px; border-left: 3px solid #17a2b8; font-size: 0.8em;">
                                    ${entry.notes}
                                </div>
                            </div>
                        ` : ''}

                        ${entry.followUp ? `
                            <div style="margin-bottom: 12px;">
                                <h4 style="color: #667eea; margin-bottom: 6px; font-size: 0.85em;">Follow-up Actions</h4>
                                <div style="background: #f8d7da; padding: 10px; border-radius: 8px; border-left: 3px solid #dc3545; font-size: 0.8em;">
                                    ${entry.followUp}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div style="text-align: center; margin-top: 15px;">
                            <span style="color: #666; font-size: 0.75em;">
                                ${entry.peopleServed || 0} people served • ${entry.duration || 0} minutes
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        function openGoogleSheets() {
            window.open(`https://docs.google.com/spreadsheets/d/${sheetsId}/edit`, '_blank');
        }

        function exportMyDailyLog() {
            const currentData = {
                activity: getRoleDisplayName(userRole), 
                staffName: currentUser, 
                date: currentDate,
                activities: document.getElementById('staffActivities').value || 'No activities specified',
                outcomes: document.getElementById('staffOutcomes').value || 'No outcomes specified',
                peopleServed: document.getElementById('staffPeopleServed').value || 'Not specified',
                duration: document.getElementById('staffDuration').value || 'Not specified',
                challenges: document.getElementById('staffChallenges').value || 'No challenges reported',
                notes: document.getElementById('staffNotes').value || 'No additional notes',
                followUp: document.getElementById('staffFollowUp').value || 'No follow-up actions specified'
            };

            const htmlContent = createDailyLogHTML(currentData);
            downloadFile(htmlContent, `Daily_Log_${currentData.staffName.replace(/\s+/g, '_')}_${currentData.activity.replace(/\s+/g, '_')}_${currentDate}.html`);
            alert('Your daily log has been exported successfully!');
        }

        function createDailyLogHTML(data) {
            return `<html><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; margin: 15px; color: #333; background: #f8f9fa; } .container { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 700px; margin: 0 auto; } .header { text-align: center; border-bottom: 3px solid #667eea; padding-bottom: 15px; margin-bottom: 25px; } .logo { height: 50px; margin-bottom: 12px; } .field { margin-bottom: 15px; } .field-label { font-weight: bold; color: #667eea; margin-bottom: 6px; display: block; font-size: 0.85em; } .field-value { padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea; white-space: pre-wrap; line-height: 1.4; font-size: 0.9em; } .stats-row { display: flex; justify-content: space-around; margin: 15px 0; padding: 12px; background: #e8f4f8; border-radius: 8px; } .stat { text-align: center; } .stat-number { font-weight: bold; color: #667eea; font-size: 1.1em; } .stat-label { font-size: 0.75em; color: #666; } @media (max-width: 600px) { body { margin: 8px; } .container { padding: 15px; } .stats-row { flex-direction: column; gap: 8px; } }</style></head><body><div class="container"><div class="header"><img src="https://lovebotswana.org/wp-content/uploads/2021/06/cropped-Love-Botswana-Logo-300x300.png" alt="LBOM Logo" class="logo" onerror="this.style.display='none'"><h1 style="font-size: 1.3em;">LBOM - Social Work Department Daily Activity Log</h1><p><strong>Activity:</strong> ${data.activity} | <strong>Staff:</strong> ${data.staffName} | <strong>Date:</strong> ${new Date(data.date).toLocaleDateString()}</p></div><div class="stats-row"><div class="stat"><div class="stat-number">${data.peopleServed}</div><div class="stat-label">People Served</div></div><div class="stat"><div class="stat-number">${data.duration}</div><div class="stat-label">Minutes</div></div><div class="stat"><div class="stat-number">${(parseFloat(data.duration) / 60).toFixed(1)}</div><div class="stat-label">Hours</div></div></div><div class="field"><div class="field-label">Today's Activities</div><div class="field-value">${data.activities}</div></div><div class="field"><div class="field-label">Key Outcomes</div><div class="field-value">${data.outcomes}</div></div><div class="field"><div class="field-label">Challenges</div><div class="field-value">${data.challenges}</div></div><div class="field"><div class="field-label">Notes</div><div class="field-value">${data.notes}</div></div><div class="field"><div class="field-label">Follow-up Actions</div><div class="field-value">${data.followUp}</div></div><div style="text-align: center; margin-top: 30px; padding-top: 15px; border-top: 1px solid #ccc;"><p><em>Exported on ${new Date().toLocaleString()}</em></p></div></div></body></html>`;
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function clearStaffForm() {
			if (confirm('Are you sure you want to clear all your log data? This will delete any unsaved changes.')) {
				document.querySelectorAll('#staffView input, #staffView textarea').forEach(field => {
					field.value = '';
				});
				document.getElementById('saveStatus').textContent = 'Ready to Log';
				document.getElementById('saveStatus').className = 'status-indicator status-ready';
			}
		}

        function logout() {
            if (confirm('Are you sure you want to logout? Any unsaved changes will be lost.')) {
                currentUser = null;
                userRole = null;
                document.getElementById('userInfo').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('dashboard').classList.remove('active');
                document.getElementById('userRole').value = '';
                document.getElementById('userName').value = '';
                document.getElementById('staffView').style.display = 'none';
                document.getElementById('adminView').style.display = 'none';
                document.getElementById('pastLogsView').style.display = 'none';
                
                // Reset form data
                document.querySelectorAll('#staffView input, #staffView textarea').forEach(field => {
                    field.value = '';
                });
                document.getElementById('saveStatus').textContent = 'Ready to Log';
                document.getElementById('saveStatus').className = 'status-indicator status-ready';
            }
        }

        // Mobile-specific enhancements
        document.addEventListener('DOMContentLoaded', function() {
            // Add pull-to-refresh simulation
            let startY = 0;
            let currentY = 0;
            let pullThreshold = 80;
            let isRefreshing = false;

            document.addEventListener('touchstart', function(e) {
                startY = e.touches[0].pageY;
            });

            document.addEventListener('touchmove', function(e) {
                currentY = e.touches[0].pageY;
                if (window.scrollY === 0 && currentY > startY && !isRefreshing) {
                    const pullDistance = currentY - startY;
                    if (pullDistance > pullThreshold) {
                        // Visual feedback for pull-to-refresh
                        const header = document.querySelector('.mobile-header');
                        if (header) {
                            header.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                        }
                    }
                }
            });

            document.addEventListener('touchend', function(e) {
                const pullDistance = currentY - startY;
                if (window.scrollY === 0 && pullDistance > pullThreshold && !isRefreshing) {
                    isRefreshing = true;
                    
                    // Reset header color
                    const header = document.querySelector('.mobile-header');
                    if (header) {
                        header.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }
                    
                    // Simulate refresh based on current view
                    if (document.getElementById('pastLogsView').style.display !== 'none') {
                        loadMyPastLogs();
                    } else if (document.getElementById('adminView').style.display !== 'none') {
                        loadAllEntries();
                    }
                    
                    setTimeout(() => {
                        isRefreshing = false;
                    }, 1000);
                }
                
                // Reset header color
                const header = document.querySelector('.mobile-header');
                if (header) {
                    header.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }
            });

            // Handle orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            });

            // Add haptic feedback simulation for buttons
            document.addEventListener('click', function(e) {
                if (e.target.matches('button, .mobile-btn, .mobile-view-btn, .mobile-export-btn')) {
                    // Vibrate if supported
                    if (navigator.vibrate) {
                        navigator.vibrate(30);
                    }
                    
                    // Visual feedback
                    e.target.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        e.target.style.transform = '';
                    }, 100);
                }
            });

            // Auto-save draft functionality for mobile
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', function() {
                    const key = `draft_${this.id}`;
                    const value = this.value;
                    if (value.trim()) {
                        sessionStorage.setItem(key, value);
                    } else {
                        sessionStorage.removeItem(key);
                    }
                });

                // Load draft on focus
                textarea.addEventListener('focus', function() {
                    const key = `draft_${this.id}`;
                    const draft = sessionStorage.getItem(key);
                    if (draft && !this.value.trim()) {
                        this.value = draft;
                        this.style.background = '#fff3cd';
                        
                        // Show restore notification
                        const notification = document.createElement('div');
                        notification.textContent = 'Draft restored';
                        notification.style.cssText = `
                            position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
                            background: #28a745; color: white; padding: 6px 12px;
                            border-radius: 15px; font-size: 0.75em; z-index: 1000;
                            animation: fadeInOut 2s ease-in-out;
                        `;
                        document.body.appendChild(notification);
                        setTimeout(() => notification.remove(), 2000);
                        
                        setTimeout(() => {
                            this.style.background = '';
                        }, 1000);
                    }
                });
            });

            // Add CSS animation for notifications
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0%, 100% { opacity: 0; transform: translateX(-50%) translateY(-15px); }
                    50% { opacity: 1; transform: translateX(-50%) translateY(0); }
                }
            `;
            document.head.appendChild(style);

            // Network status indicator
            function updateNetworkStatus() {
                const isOnline = navigator.onLine;
                const existingIndicator = document.getElementById('networkStatus');
                
                if (existingIndicator) {
                    existingIndicator.remove();
                }
                
                if (!isOnline) {
                    const indicator = document.createElement('div');
                    indicator.id = 'networkStatus';
                    indicator.textContent = 'Offline - Changes will be saved when reconnected';
                    indicator.style.cssText = `
                        position: fixed; top: 0; left: 0; right: 0; 
                        background: #dc3545; color: white; padding: 6px;
                        text-align: center; font-size: 0.75em; z-index: 1001;
                    `;
                    document.body.appendChild(indicator);
                    
                    // Adjust header position
                    document.querySelector('.mobile-header').style.marginTop = '30px';
                } else {
                    // Reset header position
                    const header = document.querySelector('.mobile-header');
                    if (header) {
                        header.style.marginTop = '';
                    }
                }
            }

            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            updateNetworkStatus();
        });

        // Initialize the application
        init();
    </script>
</body>
</html>