<!DOCTYPE html>
<html>
<head>
    <title>Debug - Love Botswana Logbook</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .debug { background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <h1>Debug Version - Function Test</h1>
    
    <div class="debug">
        <p><strong>Testing all function definitions...</strong></p>
        <button onclick="testAllFunctions()">Test All Functions</button>
        <button onclick="viewMyPastLogs()">Test viewMyPastLogs()</button>
        <button onclick="loadMyPastLogs()">Test loadMyPastLogs()</button>
    </div>
    
    <div id="output"></div>

    <script>
        // Global variables
        let currentUser = "Test User";
        let userRole = "counseling-session";
        let currentDate = '2025-01-26';
        let sheetsId = '1r93GQ6gRXHvLs0bqjPz5Wth5fsLhTzsZrRMBb20n4ZM';

        function log(message) {
            document.getElementById('output').innerHTML += '<div class="debug">' + message + '</div>';
            console.log(message);
        }

        function testAllFunctions() {
            log('Starting function tests...');
            
            // Test all function definitions
            const functions = [
                'loadMyPastLogs',
                'viewMyPastLogs', 
                'displayMyPastLogs',
                'viewMyLogDetails',
                'backToStaffView',
                'saveToGoogleSheets',
                'clearStaffForm',
                'logout'
            ];

            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`✅ ${funcName} is defined`);
                } else {
                    log(`❌ ${funcName} is NOT defined`);
                }
            });
        }

        function getRoleDisplayName(role) {
            const roleNames = {
                'admin': 'Administrator/Supervisor', 
                'operation-blessing': 'Operation Blessing',
                'counseling-session': 'Counseling Session', 
                'play-therapy': 'Play Therapy',
                'meeting': 'Meeting', 
                'case': 'Case', 
                'donations': 'Donations',
                'intake-session': 'Intake Session', 
                'workshop': 'Workshop', 
                'other-activities': 'Other Activities'
            };
            return roleNames[role] || role;
        }

        function viewMyPastLogs() {
            log('viewMyPastLogs() called successfully!');
            log('About to call loadMyPastLogs()...');
            loadMyPastLogs();
        }

        async function loadMyPastLogs() {
            log('loadMyPastLogs() function executed successfully!');
            log(`Searching for user: ${currentUser}`);
            log(`Activity type: ${getRoleDisplayName(userRole)}`);
            
            try {
                const formData = new FormData();
                formData.append('action', 'getMyLogs');
                formData.append('staffName', currentUser);
                formData.append('activityType', getRoleDisplayName(userRole));

                log('Making API call...');
                
                const response = await fetch('https://script.google.com/macros/s/AKfycbyJtF-3jhhk0Sx2FiHH--dUn-R2TU6vzeHkNiOHSrvAsq-VdbyoRPpPU0wsZru1BmT8/exec', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                log(`API Response: ${JSON.stringify(result)}`);

                if (result.success && result.data) {
                    log(`Found ${result.data.length} entries`);
                    displayMyPastLogs(result.data);
                } else {
                    throw new Error(result.error || 'Failed to load data');
                }
            } catch (error) {
                log(`Error: ${error.message}`);
            }
        }

        function displayMyPastLogs(logs) {
            log(`displayMyPastLogs() called with ${logs.length} entries`);
            if (logs && logs.length > 0) {
                log('Sample log entry: ' + JSON.stringify(logs[0]));
            }
        }

        function viewMyLogDetails(index) {
            log(`viewMyLogDetails(${index}) called`);
        }

        function backToStaffView() {
            log('backToStaffView() called');
        }

        function saveToGoogleSheets() {
            log('saveToGoogleSheets() called');
        }

        function clearStaffForm() {
            log('clearStaffForm() called');
        }

        function logout() {
            log('logout() called');
        }

        // Auto-run test on load
        window.addEventListener('load', function() {
            log('Page loaded. Running automatic function test...');
            testAllFunctions();
        });
    </script>
</body>
</html>